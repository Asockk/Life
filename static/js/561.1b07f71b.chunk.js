"use strict";(self.webpackChunkblutdruck_tracker=self.webpackChunkblutdruck_tracker||[]).push([[561],{6183:(e,t,r)=>{r.d(t,{G:()=>s});const s=function(e){const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(new Date).getFullYear(),s=[...e].sort((e,t)=>{const s=e=>{let t,s,a=r;if(e.includes(".")){const r=e.split(". ");t=parseInt(r[0]);const n=r[1].split(" ");if(s=n[0],n.length>1){const e=parseInt(n[n.length-1]);!isNaN(e)&&e>2e3&&(a=e)}}else{if(!e.includes(" "))return new Date(0);{const r=e.split(" ");if(s=r[0],t=parseInt(r[1]),r.length>2){const e=parseInt(r[r.length-1]);!isNaN(e)&&e>2e3&&(a=e)}}}return new Date(a,{Januar:0,Februar:1,"M\xe4rz":2,April:3,Mai:4,Juni:5,Juli:6,August:7,September:8,Oktober:9,November:10,Dezember:11}[s],t)};return s(e.datum)-s(t.datum)}),a={Mo:"Montag",Di:"Dienstag",Mi:"Mittwoch",Do:"Donnerstag",Fr:"Freitag",Sa:"Samstag",So:"Sonntag"};return[["Tag","Datum","Blutdruck Morgen","","","Blutdruck Abend","","","Kontextfaktoren","","","","",""].join(";"),["","","Sys","Dia","Puls","Sys","Dia","Puls","Stress","Schlaf","Aktivit\xe4t","Salz","Koffein","Alkohol"].join(";"),...s.map(e=>{const s=(e=>{if(!e)return"";let t,s,a=r;if(e.includes(".")){const r=e.split(". ");t=parseInt(r[0]);const n=r[1].split(" ");if(s=n[0],n.length>1){const e=parseInt(n[n.length-1]);!isNaN(e)&&e>2e3&&(a=e)}}else{if(!e.includes(" "))return"";{const r=e.split(" ");if(s=r[0],t=parseInt(r[1]),r.length>2){const e=parseInt(r[r.length-1]);!isNaN(e)&&e>2e3&&(a=e)}}}return`${a}-${{Januar:"01",Februar:"02","M\xe4rz":"03",April:"04",Mai:"05",Juni:"06",Juli:"07",August:"08",September:"09",Oktober:"10",November:"11",Dezember:"12"}[s]||"01"}-${String(t).padStart(2,"0")}`})(e.datum),n=t[s]||{};let l=e.datum,i=!1;return l.match(/\d{4}/)&&(i=!0),i||(l.includes(".")||l.includes(" "))&&(l=`${l} ${r}`),[a[e.tag]||e.tag,l,e.morgenSys||0,e.morgenDia||0,e.morgenPuls||0,e.abendSys||0,e.abendDia||0,e.abendPuls||0,void 0!==n.stress?n.stress:"",void 0!==n.sleep?n.sleep:"",void 0!==n.activity?n.activity:"",void 0!==n.salt?n.salt:"",void 0!==n.caffeine?n.caffeine:"",void 0!==n.alcohol?n.alcohol:""].join(";")})].join("\n")}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),a=document.createElement("a"),n=(new Date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return a.href=s,a.setAttribute("download",`Blutdruck-Daten_${n}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),`Blutdruck-Daten_${n}.csv`}},7008:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},8561:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var s=r(5043),a=r(1172),n=r(3797);const l=(0,n.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var i=r(7008);const o=(0,n.A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),c=(0,n.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var d=r(1024),x=r(5991),u=r(6183),m=r(3247),h=r(579);const g=e=>{if(!e||!e.datum)return e;const t={...e},r={January:"Januar",February:"Februar",March:"M\xe4rz",April:"April",May:"Mai",June:"Juni",July:"Juli",August:"August",September:"September",October:"Oktober",November:"November",December:"Dezember"};let s=e.datum;if(s.includes(".")&&s.includes(",")){const e=s.split(".");if(e.length>=2){const s=e[0].trim();let a=e[1].trim();a.includes(",")&&(a=a.split(",")[0].trim());for(const[e,t]of Object.entries(r))if(a.includes(e)){a=a.replace(e,t);break}t.datum=`${s}. ${a}`}}else if(s.includes(" ")&&!s.includes(".")){const e=s.split(" ");if(e.length>=2){let s=e[0].trim(),a=e[1].trim();a.includes(",")&&(a=a.replace(",","")),s=r[s]||s,t.datum=`${a}. ${s}`}}return t},b=e=>{let{onImport:t,onClose:r,data:n,contextFactors:b,darkMode:p}=e;const[y,f]=(0,s.useState)(null),[j,v]=(0,s.useState)(""),[k,N]=(0,s.useState)([]),[w,D]=(0,s.useState)(""),[S,z]=(0,s.useState)(!1),[C,A]=(0,s.useState)("csv"),[F,B]=(0,s.useState)(!1),M=e=>{const t=e.target.files[0];v(""),D(""),f(null),N([]),t&&(z(!0),"backup"===C||t.name.toLowerCase().endsWith(".json")?I(t):$(t))},$=e=>{if(!("text/csv"===e.type||e.name.toLowerCase().endsWith(".csv")||e.name.toLowerCase().endsWith(".txt")))return v("Bitte w\xe4hlen Sie eine CSV- oder Textdatei aus."),void z(!1);const t=new FileReader;t.onload=e=>{try{const t=e.target.result;if(!t||"string"!==typeof t)throw new Error("Die Datei enth\xe4lt keinen g\xfcltigen Text.");const r=(0,x.sl)(t),s=r.data.map(g);f(s),N(s.slice(0,5));let a="";r.skippedCount>0&&(a+=`${r.skippedCount} Datens\xe4tze ohne Blutdruckwerte wurden ignoriert. `),r.zeroValuesCount>0&&(a+=`${r.zeroValuesCount} Datens\xe4tze enthalten einzelne Nullwerte, die im Diagramm ignoriert werden.`),a&&D(a),z(!1)}catch(t){console.error("Fehler beim Parsen der CSV-Datei:",t),v(t.message||"Fehler beim Parsen der Datei."),f(null),N([]),z(!1)}},t.onerror=()=>{v("Fehler beim Lesen der Datei."),z(!1)},t.readAsText(e)},I=e=>{if(!("application/json"===e.type||e.name.toLowerCase().endsWith(".json")))return v("Bitte w\xe4hlen Sie eine JSON-Backup-Datei aus."),void z(!1);const t=new FileReader;t.onload=async e=>{try{const t=e.target.result;if(!t||"string"!==typeof t)throw new Error("Die Datei enth\xe4lt keinen g\xfcltigen Text.");const r=JSON.parse(t);if(!r.measurements||!Array.isArray(r.measurements))throw new Error("Ung\xfcltiges Backup-Format: Messungen fehlen oder haben falsches Format");f(t),N(r.measurements.slice(0,5)),D(`Backup vom ${new Date(r.exportDate).toLocaleString()} mit ${r.measurements.length} Messungen und ${Object.keys(r.contextFactors||{}).length} Kontextfaktoren.`),z(!1)}catch(t){console.error("Fehler beim Parsen der Backup-Datei:",t),v(t.message||"Fehler beim Parsen der Backup-Datei."),f(null),N([]),z(!1)}},t.onerror=()=>{v("Fehler beim Lesen der Datei."),z(!1)},t.readAsText(e)};return(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:(0,h.jsxs)("div",{className:(p?"bg-gray-800":"bg-white")+" rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] flex flex-col",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsx)("h3",{className:"text-lg font-medium "+(p?"text-white":"text-gray-900"),children:"Blutdruckdaten importieren/exportieren"}),(0,h.jsx)("button",{onClick:r,className:""+(p?"text-gray-400 hover:text-gray-300":"text-gray-400 hover:text-gray-500"),disabled:S,children:(0,h.jsx)(a.A,{size:20})})]}),(0,h.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,h.jsxs)("div",{className:"flex border-b mb-4 "+(p?"border-gray-700":"border-gray-200"),children:[(0,h.jsx)("button",{className:"px-4 py-2 "+("csv"===C?"border-b-2 border-blue-500 "+(p?"text-blue-400":"text-blue-600"):""+(p?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700")),onClick:()=>A("csv"),children:"CSV Import/Export"}),(0,h.jsx)("button",{className:"px-4 py-2 "+("backup"===C?"border-b-2 border-blue-500 "+(p?"text-blue-400":"text-blue-600"):""+(p?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700")),onClick:()=>A("backup"),children:"Backup & Wiederherstellung"})]}),"csv"===C?(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm mb-4 "+(p?"text-gray-300":"text-gray-600"),children:[(0,h.jsx)("strong",{children:"Daten importieren:"})," W\xe4hlen Sie eine CSV-Datei mit Blutdruckdaten aus. Das Format sollte Spalten f\xfcr Tag, Datum, und Blutdruckwerte enthalten."]}),(0,h.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center "+(p?"border-gray-600":"border-gray-300"),children:[(0,h.jsx)("input",{type:"file",id:"file-upload",className:"hidden",accept:".csv,.txt",onChange:M,disabled:S}),(0,h.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center "+(S?"opacity-50":""),children:[(0,h.jsx)(l,{size:40,className:"mb-2 "+(p?"text-blue-400":"text-blue-500")}),(0,h.jsx)("span",{className:"font-medium "+(p?"text-blue-400":"text-blue-500"),children:"CSV-Datei ausw\xe4hlen"}),(0,h.jsx)("span",{className:"text-xs mt-1 "+(p?"text-gray-400":"text-gray-500"),children:"oder hierher ziehen"})]})]})]}),(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm mb-4 "+(p?"text-gray-300":"text-gray-600"),children:[(0,h.jsx)("strong",{children:"Daten exportieren:"})," Laden Sie Ihre aktuellen Blutdruckdaten als CSV-Datei herunter, um sie zu sichern oder in anderen Programmen zu verwenden."]}),(0,h.jsx)("div",{className:"border-2 rounded-lg p-6 text-center "+(p?"border-gray-600":"border-gray-300"),children:(0,h.jsxs)("button",{onClick:()=>{if(n&&0!==n.length)try{const e=(0,u.G)(n,b);D(`CSV-Export wurde erfolgreich erstellt: ${e}`)}catch(e){console.error("Fehler beim CSV-Export:",e),v("Fehler beim Exportieren der CSV-Datei: "+e.message)}else v("Keine Daten zum Exportieren vorhanden.")},className:"cursor-pointer flex flex-col items-center w-full "+(S?"opacity-50":""),disabled:S,children:[(0,h.jsx)(i.A,{size:40,className:"mb-2 "+(p?"text-green-400":"text-green-500")}),(0,h.jsx)("span",{className:"font-medium "+(p?"text-green-400":"text-green-500"),children:"Daten als CSV exportieren"}),(0,h.jsx)("span",{className:"text-xs mt-1 "+(p?"text-gray-400":"text-gray-500"),children:"Enth\xe4lt alle Messungen und Kontextfaktoren"})]})})]})]}):(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm mb-4 "+(p?"text-gray-300":"text-gray-600"),children:[(0,h.jsx)("strong",{children:"Backup wiederherstellen:"})," W\xe4hlen Sie eine zuvor erstellte Backup-Datei, um Ihre Daten wiederherzustellen oder auf ein anderes Ger\xe4t zu \xfcbertragen."]}),(0,h.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center "+(p?"border-gray-600":"border-gray-300"),children:[(0,h.jsx)("input",{type:"file",id:"backup-upload",className:"hidden",accept:".json",onChange:M,disabled:S}),(0,h.jsxs)("label",{htmlFor:"backup-upload",className:"cursor-pointer flex flex-col items-center "+(S?"opacity-50":""),children:[(0,h.jsx)(l,{size:40,className:"mb-2 "+(p?"text-blue-400":"text-blue-500")}),(0,h.jsx)("span",{className:"font-medium "+(p?"text-blue-400":"text-blue-500"),children:"Backup-Datei ausw\xe4hlen"}),(0,h.jsx)("span",{className:"text-xs mt-1 "+(p?"text-gray-400":"text-gray-500"),children:".json Format"})]})]})]}),(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm mb-4 "+(p?"text-gray-300":"text-gray-600"),children:[(0,h.jsx)("strong",{children:"Vollst\xe4ndiges Backup erstellen:"})," Sichern Sie alle Ihre Daten (Messungen, Kontextfaktoren, Einstellungen) in einer einzigen Datei."]}),(0,h.jsx)("div",{className:"border-2 rounded-lg p-6 text-center "+(p?"border-gray-600":"border-gray-300"),children:(0,h.jsxs)("button",{onClick:async()=>{z(!0);try{const e=await(0,m.uv)();D(`Backup wurde erfolgreich erstellt: ${e}`)}catch(e){console.error("Fehler beim Erstellen des Backups:",e),v("Fehler beim Erstellen des Backups: "+e.message)}finally{z(!1)}},className:"cursor-pointer flex flex-col items-center w-full "+(S?"opacity-50":""),disabled:S,children:[(0,h.jsx)(o,{size:40,className:"mb-2 "+(p?"text-green-400":"text-green-500")}),(0,h.jsx)("span",{className:"font-medium "+(p?"text-green-400":"text-green-500"),children:"Backup erstellen"}),(0,h.jsx)("span",{className:"text-xs mt-1 "+(p?"text-gray-400":"text-gray-500"),children:"Exportiert alle Daten als JSON-Datei"})]})}),(0,h.jsxs)("div",{className:"mt-4 border-t pt-4 "+(p?"border-gray-700":"border-gray-200"),children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[(0,h.jsx)("strong",{children:"Alle Daten l\xf6schen:"})," Entfernt alle gespeicherten Daten und setzt die App zur\xfcck."]}),(0,h.jsxs)("button",{onClick:async()=>{if(F){z(!0);try{await(0,m.Bq)(),D("Alle Daten wurden erfolgreich gel\xf6scht. Die App wird neu geladen."),setTimeout(()=>{window.location.reload()},1500)}catch(e){console.error("Fehler beim L\xf6schen der Daten:",e),v("Fehler beim L\xf6schen der Daten: "+e.message),B(!1)}finally{z(!1)}}else B(!0)},className:"w-full flex items-center justify-center py-2 px-4 rounded-md "+(F?"bg-red-600 text-white":p?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),disabled:S,children:[(0,h.jsx)(c,{size:16,className:"mr-2"}),F?"Wirklich alle Daten l\xf6schen?":"Daten zur\xfccksetzen"]})]})]})]}),j&&(0,h.jsxs)("div",{className:"mt-3 text-sm p-3 rounded-md border "+(p?"text-red-400 bg-red-900/20 border-red-800":"text-red-600 bg-red-50 border-red-200"),children:["Fehler: ",j]}),w&&(0,h.jsxs)("div",{className:"mt-3 text-sm p-3 rounded-md border "+(p?"text-blue-400 bg-blue-900/20 border-blue-800":"text-blue-600 bg-blue-50 border-blue-200"),children:["Info: ",w]}),S&&(0,h.jsxs)("div",{className:"mt-3 text-sm flex items-center justify-center p-4 "+(p?"text-gray-300":"text-gray-600"),children:[(0,h.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 "+(p?"text-blue-400":"text-blue-600"),viewBox:"0 0 24 24",children:[(0,h.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,h.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Bitte warten..."]}),k.length>0&&(0,h.jsxs)("div",{className:"mt-4 max-h-[40vh] overflow-y-auto",children:[(0,h.jsx)("h4",{className:"text-sm font-medium mb-2 "+(p?"text-white":"text-gray-900"),children:"Vorschau der Importdaten:"}),(0,h.jsxs)("div",{className:"overflow-x-auto rounded p-2 "+(p?"bg-gray-700":"bg-gray-50"),children:[(0,h.jsxs)("table",{className:"min-w-full text-xs "+(p?"text-gray-300":"text-gray-900"),children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b "+(p?"border-gray-600":"border-gray-200"),children:[(0,h.jsx)("th",{className:"p-1 text-left "+(p?"text-gray-300":"text-gray-700"),children:"Tag"}),(0,h.jsx)("th",{className:"p-1 text-left "+(p?"text-gray-300":"text-gray-700"),children:"Datum"}),(0,h.jsx)("th",{className:"p-1 text-center "+(p?"text-gray-300":"text-gray-700"),children:"Morgen (Sys/Dia/Puls)"}),(0,h.jsx)("th",{className:"p-1 text-center "+(p?"text-gray-300":"text-gray-700"),children:"Abend (Sys/Dia/Puls)"})]})}),(0,h.jsx)("tbody",{children:k.map((e,t)=>(0,h.jsxs)("tr",{className:"border-b "+(p?"border-gray-600":"border-gray-200"),children:[(0,h.jsx)("td",{className:"p-1 "+(p?"text-gray-300":"text-gray-900"),children:e.tag}),(0,h.jsx)("td",{className:"p-1 "+(p?"text-gray-300":"text-gray-900"),children:e.datum}),(0,h.jsx)("td",{className:"p-1 text-center "+(p?"text-gray-300":"text-gray-900"),children:e.morgenSys>0&&e.morgenDia>0?`${e.morgenSys}/${e.morgenDia}/${e.morgenPuls}`:"-"}),(0,h.jsx)("td",{className:"p-1 text-center "+(p?"text-gray-300":"text-gray-900"),children:e.abendSys>0&&e.abendDia>0?`${e.abendSys}/${e.abendDia}/${e.abendPuls}`:"-"})]},t))})]}),y&&(Array.isArray(y)&&y.length>k.length?(0,h.jsxs)("p",{className:"text-xs mt-2 "+(p?"text-gray-400":"text-gray-500"),children:["...und ",y.length-k.length," weitere Eintr\xe4ge"]}):(0,h.jsx)("p",{className:"text-xs mt-2 "+(p?"text-gray-400":"text-gray-500"),children:"Vorschau der ersten 5 Eintr\xe4ge"}))]})]})]}),y&&(0,h.jsxs)("div",{className:"sticky bottom-0 pt-4 border-t flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 "+(p?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,h.jsx)("button",{type:"button",onClick:r,className:"w-full sm:w-auto py-2 px-4 border rounded-md shadow-sm text-sm font-medium focus:outline-none "+(p?"bg-gray-700 border-gray-600 text-gray-200 hover:bg-gray-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),disabled:S,children:"Abbrechen"}),(0,h.jsxs)("button",{type:"button",onClick:async()=>{if(y){z(!0);try{if("backup"===C||"string"===typeof y){(await(0,m.Jt)(y)).success?r():v("Fehler beim Importieren der Backup-Datei.")}else t(y)?r():v("Fehler beim Importieren der Daten.")}catch(e){console.error("Fehler beim Import:",e),v(e.message||"Import fehlgeschlagen.")}finally{z(!1)}}else v("Keine Daten zum Importieren vorhanden.")},className:"w-full sm:w-auto py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none flex items-center justify-center bg-blue-600 hover:bg-blue-700",disabled:S,children:[(0,h.jsx)(d.A,{size:16,className:"mr-2"}),"Importieren"]})]})]})})}}}]);
//# sourceMappingURL=561.1b07f71b.chunk.js.map