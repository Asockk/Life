"use strict";(self.webpackChunkblutdruck_tracker=self.webpackChunkblutdruck_tracker||[]).push([[561],{6183:(e,t,s)=>{s.d(t,{G:()=>r});const r=function(e){const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=(new Date).getFullYear(),r=[...e].sort(((e,t)=>{const r=e=>{let t,r,n=s;if(e.includes(".")){const s=e.split(". ");t=parseInt(s[0]);const a=s[1].split(" ");if(r=a[0],a.length>1){const e=parseInt(a[a.length-1]);!isNaN(e)&&e>2e3&&(n=e)}}else{if(!e.includes(" "))return new Date(0);{const s=e.split(" ");if(r=s[0],t=parseInt(s[1]),s.length>2){const e=parseInt(s[s.length-1]);!isNaN(e)&&e>2e3&&(n=e)}}}return new Date(n,{Januar:0,Februar:1,"M\xe4rz":2,April:3,Mai:4,Juni:5,Juli:6,August:7,September:8,Oktober:9,November:10,Dezember:11}[r],t)};return r(e.datum)-r(t.datum)})),n={Mo:"Montag",Di:"Dienstag",Mi:"Mittwoch",Do:"Donnerstag",Fr:"Freitag",Sa:"Samstag",So:"Sonntag"};return[["Tag","Datum","Blutdruck Morgen","","","Blutdruck Abend","","","Kontextfaktoren","","","","",""].join(";"),["","","Sys","Dia","Puls","Sys","Dia","Puls","Stress","Schlaf","Aktivit\xe4t","Salz","Koffein","Alkohol"].join(";"),...r.map((e=>{const r=(e=>{if(!e)return"";let t,r,n=s;if(e.includes(".")){const s=e.split(". ");t=parseInt(s[0]);const a=s[1].split(" ");if(r=a[0],a.length>1){const e=parseInt(a[a.length-1]);!isNaN(e)&&e>2e3&&(n=e)}}else{if(!e.includes(" "))return"";{const s=e.split(" ");if(r=s[0],t=parseInt(s[1]),s.length>2){const e=parseInt(s[s.length-1]);!isNaN(e)&&e>2e3&&(n=e)}}}return`${n}-${{Januar:"01",Februar:"02","M\xe4rz":"03",April:"04",Mai:"05",Juni:"06",Juli:"07",August:"08",September:"09",Oktober:"10",November:"11",Dezember:"12"}[r]||"01"}-${String(t).padStart(2,"0")}`})(e.datum),a=t[r]||{};let l=e.datum,i=!1;return l.match(/\d{4}/)&&(i=!0),i||(l.includes(".")||l.includes(" "))&&(l=`${l} ${s}`),[n[e.tag]||e.tag,l,e.morgenSys||0,e.morgenDia||0,e.morgenPuls||0,e.abendSys||0,e.abendDia||0,e.abendPuls||0,void 0!==a.stress?a.stress:"",void 0!==a.sleep?a.sleep:"",void 0!==a.activity?a.activity:"",void 0!==a.salt?a.salt:"",void 0!==a.caffeine?a.caffeine:"",void 0!==a.alcohol?a.alcohol:""].join(";")}))].join("\n")}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),n=document.createElement("a"),a=(new Date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return n.href=r,n.setAttribute("download",`Blutdruck-Daten_${a}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),`Blutdruck-Daten_${a}.csv`}},7008:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},8561:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var r=s(5043),n=s(1172),a=s(3797);const l=(0,a.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var i=s(7008);const c=(0,a.A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),o=(0,a.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var d=s(1024),m=s(5991),u=s(6183),x=s(4094),h=s(579);const p=e=>{if(!e||!e.datum)return e;const t={...e},s={January:"Januar",February:"Februar",March:"M\xe4rz",April:"April",May:"Mai",June:"Juni",July:"Juli",August:"August",September:"September",October:"Oktober",November:"November",December:"Dezember"};let r=e.datum;if(r.includes(".")&&r.includes(",")){const e=r.split(".");if(e.length>=2){const r=e[0].trim();let n=e[1].trim();n.includes(",")&&(n=n.split(",")[0].trim());for(const[e,t]of Object.entries(s))if(n.includes(e)){n=n.replace(e,t);break}t.datum=`${r}. ${n}`}}else if(r.includes(" ")&&!r.includes(".")){const e=r.split(" ");if(e.length>=2){let r=e[0].trim(),n=e[1].trim();n.includes(",")&&(n=n.replace(",","")),r=s[r]||r,t.datum=`${n}. ${r}`}}return t},b=e=>{let{onImport:t,onClose:s,data:a,contextFactors:b}=e;const[g,y]=(0,r.useState)(null),[f,j]=(0,r.useState)(""),[k,N]=(0,r.useState)([]),[v,w]=(0,r.useState)(""),[D,S]=(0,r.useState)(!1),[z,C]=(0,r.useState)("csv"),[A,F]=(0,r.useState)(!1),B=e=>{const t=e.target.files[0];j(""),w(""),y(null),N([]),t&&(S(!0),"backup"===z||t.name.toLowerCase().endsWith(".json")?$(t):M(t))},M=e=>{if(!("text/csv"===e.type||e.name.toLowerCase().endsWith(".csv")||e.name.toLowerCase().endsWith(".txt")))return j("Bitte w\xe4hlen Sie eine CSV- oder Textdatei aus."),void S(!1);const t=new FileReader;t.onload=e=>{try{const t=e.target.result;if(!t||"string"!==typeof t)throw new Error("Die Datei enth\xe4lt keinen g\xfcltigen Text.");const s=(0,m.sl)(t),r=s.data.map(p);y(r),N(r.slice(0,5));let n="";s.skippedCount>0&&(n+=`${s.skippedCount} Datens\xe4tze ohne Blutdruckwerte wurden ignoriert. `),s.zeroValuesCount>0&&(n+=`${s.zeroValuesCount} Datens\xe4tze enthalten einzelne Nullwerte, die im Diagramm ignoriert werden.`),n&&w(n),S(!1)}catch(t){console.error("Fehler beim Parsen der CSV-Datei:",t),j(t.message||"Fehler beim Parsen der Datei."),y(null),N([]),S(!1)}},t.onerror=()=>{j("Fehler beim Lesen der Datei."),S(!1)},t.readAsText(e)},$=e=>{if(!("application/json"===e.type||e.name.toLowerCase().endsWith(".json")))return j("Bitte w\xe4hlen Sie eine JSON-Backup-Datei aus."),void S(!1);const t=new FileReader;t.onload=async e=>{try{const t=e.target.result;if(!t||"string"!==typeof t)throw new Error("Die Datei enth\xe4lt keinen g\xfcltigen Text.");const s=JSON.parse(t);if(!s.measurements||!Array.isArray(s.measurements))throw new Error("Ung\xfcltiges Backup-Format: Messungen fehlen oder haben falsches Format");y(t),N(s.measurements.slice(0,5)),w(`Backup vom ${new Date(s.exportDate).toLocaleString()} mit ${s.measurements.length} Messungen und ${Object.keys(s.contextFactors||{}).length} Kontextfaktoren.`),S(!1)}catch(t){console.error("Fehler beim Parsen der Backup-Datei:",t),j(t.message||"Fehler beim Parsen der Backup-Datei."),y(null),N([]),S(!1)}},t.onerror=()=>{j("Fehler beim Lesen der Datei."),S(!1)},t.readAsText(e)};return(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] flex flex-col",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsx)("h3",{className:"text-lg font-medium",children:"Blutdruckdaten importieren/exportieren"}),(0,h.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-500",disabled:D,children:(0,h.jsx)(n.A,{size:20})})]}),(0,h.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,h.jsxs)("div",{className:"flex border-b mb-4",children:[(0,h.jsx)("button",{className:"px-4 py-2 "+("csv"===z?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>C("csv"),children:"CSV Import/Export"}),(0,h.jsx)("button",{className:"px-4 py-2 "+("backup"===z?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>C("backup"),children:"Backup & Wiederherstellung"})]}),"csv"===z?(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:[(0,h.jsx)("strong",{children:"Daten importieren:"})," W\xe4hlen Sie eine CSV-Datei mit Blutdruckdaten aus. Das Format sollte Spalten f\xfcr Tag, Datum, und Blutdruckwerte enthalten."]}),(0,h.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,h.jsx)("input",{type:"file",id:"file-upload",className:"hidden",accept:".csv,.txt",onChange:B,disabled:D}),(0,h.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center "+(D?"opacity-50":""),children:[(0,h.jsx)(l,{size:40,className:"text-blue-500 mb-2"}),(0,h.jsx)("span",{className:"font-medium text-blue-500",children:"CSV-Datei ausw\xe4hlen"}),(0,h.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"oder hierher ziehen"})]})]})]}),(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:[(0,h.jsx)("strong",{children:"Daten exportieren:"})," Laden Sie Ihre aktuellen Blutdruckdaten als CSV-Datei herunter, um sie zu sichern oder in anderen Programmen zu verwenden."]}),(0,h.jsx)("div",{className:"border-2 border-gray-300 rounded-lg p-6 text-center",children:(0,h.jsxs)("button",{onClick:()=>{if(a&&0!==a.length)try{const e=(0,u.G)(a,b);w(`CSV-Export wurde erfolgreich erstellt: ${e}`)}catch(e){console.error("Fehler beim CSV-Export:",e),j("Fehler beim Exportieren der CSV-Datei: "+e.message)}else j("Keine Daten zum Exportieren vorhanden.")},className:"cursor-pointer flex flex-col items-center w-full "+(D?"opacity-50":""),disabled:D,children:[(0,h.jsx)(i.A,{size:40,className:"text-green-500 mb-2"}),(0,h.jsx)("span",{className:"font-medium text-green-500",children:"Daten als CSV exportieren"}),(0,h.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"Enth\xe4lt alle Messungen und Kontextfaktoren"})]})})]})]}):(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:[(0,h.jsx)("strong",{children:"Backup wiederherstellen:"})," W\xe4hlen Sie eine zuvor erstellte Backup-Datei, um Ihre Daten wiederherzustellen oder auf ein anderes Ger\xe4t zu \xfcbertragen."]}),(0,h.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,h.jsx)("input",{type:"file",id:"backup-upload",className:"hidden",accept:".json",onChange:B,disabled:D}),(0,h.jsxs)("label",{htmlFor:"backup-upload",className:"cursor-pointer flex flex-col items-center "+(D?"opacity-50":""),children:[(0,h.jsx)(l,{size:40,className:"text-blue-500 mb-2"}),(0,h.jsx)("span",{className:"font-medium text-blue-500",children:"Backup-Datei ausw\xe4hlen"}),(0,h.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:".json Format"})]})]})]}),(0,h.jsxs)("div",{className:"flex-1 min-w-[280px]",children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:[(0,h.jsx)("strong",{children:"Vollst\xe4ndiges Backup erstellen:"})," Sichern Sie alle Ihre Daten (Messungen, Kontextfaktoren, Einstellungen) in einer einzigen Datei."]}),(0,h.jsx)("div",{className:"border-2 border-gray-300 rounded-lg p-6 text-center",children:(0,h.jsxs)("button",{onClick:async()=>{S(!0);try{const e=await(0,x.uv)();w(`Backup wurde erfolgreich erstellt: ${e}`)}catch(e){console.error("Fehler beim Erstellen des Backups:",e),j("Fehler beim Erstellen des Backups: "+e.message)}finally{S(!1)}},className:"cursor-pointer flex flex-col items-center w-full "+(D?"opacity-50":""),disabled:D,children:[(0,h.jsx)(c,{size:40,className:"text-green-500 mb-2"}),(0,h.jsx)("span",{className:"font-medium text-green-500",children:"Backup erstellen"}),(0,h.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"Exportiert alle Daten als JSON-Datei"})]})}),(0,h.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,h.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[(0,h.jsx)("strong",{children:"Alle Daten l\xf6schen:"})," Entfernt alle gespeicherten Daten und setzt die App zur\xfcck."]}),(0,h.jsxs)("button",{onClick:async()=>{if(A){S(!0);try{await(0,x.Bq)(),w("Alle Daten wurden erfolgreich gel\xf6scht. Die App wird neu geladen."),setTimeout((()=>{window.location.reload()}),1500)}catch(e){console.error("Fehler beim L\xf6schen der Daten:",e),j("Fehler beim L\xf6schen der Daten: "+e.message),F(!1)}finally{S(!1)}}else F(!0)},className:"w-full flex items-center justify-center py-2 px-4 rounded-md "+(A?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),disabled:D,children:[(0,h.jsx)(o,{size:16,className:"mr-2"}),A?"Wirklich alle Daten l\xf6schen?":"Daten zur\xfccksetzen"]})]})]})]}),f&&(0,h.jsxs)("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-3 rounded-md border border-red-200",children:["Fehler: ",f]}),v&&(0,h.jsxs)("div",{className:"mt-3 text-sm text-blue-600 bg-blue-50 p-3 rounded-md border border-blue-200",children:["Info: ",v]}),D&&(0,h.jsxs)("div",{className:"mt-3 text-sm text-gray-600 flex items-center justify-center p-4",children:[(0,h.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-600 mr-3",viewBox:"0 0 24 24",children:[(0,h.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,h.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Bitte warten..."]}),k.length>0&&(0,h.jsxs)("div",{className:"mt-4 max-h-[40vh] overflow-y-auto",children:[(0,h.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Vorschau der Importdaten:"}),(0,h.jsxs)("div",{className:"overflow-x-auto bg-gray-50 rounded p-2",children:[(0,h.jsxs)("table",{className:"min-w-full text-xs",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b",children:[(0,h.jsx)("th",{className:"p-1 text-left",children:"Tag"}),(0,h.jsx)("th",{className:"p-1 text-left",children:"Datum"}),(0,h.jsx)("th",{className:"p-1 text-center",children:"Morgen (Sys/Dia/Puls)"}),(0,h.jsx)("th",{className:"p-1 text-center",children:"Abend (Sys/Dia/Puls)"})]})}),(0,h.jsx)("tbody",{children:k.map(((e,t)=>(0,h.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,h.jsx)("td",{className:"p-1",children:e.tag}),(0,h.jsx)("td",{className:"p-1",children:e.datum}),(0,h.jsx)("td",{className:"p-1 text-center",children:e.morgenSys>0&&e.morgenDia>0?`${e.morgenSys}/${e.morgenDia}/${e.morgenPuls}`:"-"}),(0,h.jsx)("td",{className:"p-1 text-center",children:e.abendSys>0&&e.abendDia>0?`${e.abendSys}/${e.abendDia}/${e.abendPuls}`:"-"})]},t)))})]}),g&&(Array.isArray(g)&&g.length>k.length?(0,h.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["...und ",g.length-k.length," weitere Eintr\xe4ge"]}):(0,h.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Vorschau der ersten 5 Eintr\xe4ge"}))]})]})]}),g&&(0,h.jsxs)("div",{className:"sticky bottom-0 bg-white pt-4 border-t border-gray-200 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,h.jsx)("button",{type:"button",onClick:s,className:"w-full sm:w-auto bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",disabled:D,children:"Abbrechen"}),(0,h.jsxs)("button",{type:"button",onClick:async()=>{if(g){S(!0);try{if("backup"===z||"string"===typeof g){(await(0,x.Jt)(g)).success?s():j("Fehler beim Importieren der Backup-Datei.")}else t(g)?s():j("Fehler beim Importieren der Daten.")}catch(e){console.error("Fehler beim Import:",e),j(e.message||"Import fehlgeschlagen.")}finally{S(!1)}}else j("Keine Daten zum Importieren vorhanden.")},className:"w-full sm:w-auto bg-blue-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-blue-700 focus:outline-none flex items-center justify-center",disabled:D,children:[(0,h.jsx)(d.A,{size:16,className:"mr-2"}),"Importieren"]})]})]})})}}}]);
//# sourceMappingURL=561.ef776928.chunk.js.map